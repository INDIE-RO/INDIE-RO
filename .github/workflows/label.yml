name: 'Labeler'
on:
  issues:
    types: [opened, edited]
  pull_request_target:
    types: [opened, reopened, synchronize]

jobs:
  triage:
    permissions:
      contents: read
      pull-requests: write
      issues: write
    runs-on: ubuntu-latest
    steps:
      - name: Check Labels
        uses: actions/labeler@v5
        with:
          repo-token: '${{ secrets.GITHUB_TOKEN }}'
          sync-labels: true

      - name: Apply Labels based on Author
        uses: actions/github-script@v5
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const applyLabels = async () => {
              const payload = context.payload;
              const issueAuthor = payload.issue ? payload.issue.user.login : (payload.pull_request ? payload.pull_request.user.login : null);

              if (!issueAuthor) {
                return;
              }

            const labelsToAdd = {
              'HASEUNGHEEE': 'Backend',
              'enxxo': 'Data',
              'HyeryongChoi': 'Frontend',
              'hae-on': 'Frontend'
            };

              if (labelsToAdd[issueAuthor]) {
                await github.issues.addLabels({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  issue_number: payload.issue ? payload.issue.number : payload.pull_request.number,
                  labels: [labelsToAdd[issueAuthor]]
                });
              }
            };

            applyLabels();
